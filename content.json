[{"title":"docker swarm集群搭建","date":"2017-11-06T03:28:22.000Z","path":"2017/11/06/docker-swarm集群搭建/","text":"简介：dokcer swarm是一个docker集群管理工具，把大量的docker容器集中管理，类似的还有k8s等。 准备：本案例需要2台以上机器，这里使用docker machine来生成3台虚拟机来测试。可根据自己资源多少来选择不同的方案。创建一个管理节点机器manager1，两个工作节点worker1和worker2 #docker-machine create --driver virtualbox manager1 #docker-machine create --driver virtualbox worker1 #docker-machine create --driver virtualbox worker2 现在，有两三台虚拟机，我们查看一下： #docker-machine ls NAME ACTIVE DRIVER STATE URL SWARM DOCKER ERRORS manager1 - virtualbox Running tcp://192.168.99.100:2376 v17.10.0-ce worker1 - virtualbox Running tcp://192.168.99.103:2376 v17.10.0-ce worker2 - virtualbox Running tcp://192.168.99.104:2376 v17.10.0-ce 创建swarm集群：用上面创建的3台虚拟机，来创建一个swarm集群，首先进入管理节点： #docker-machine ssh manager1 #docker swarm init --listen-addr 192.168.99.100:2377 --advertise-addr 192.168.99.100 Swarm initialized: current node (23lkbq7uovqsg550qfzup59t6) is now a manager. To add a worker to this swarm, run the following command: docker swarm join \\ --token SWMTKN-1-3z5rzoey0u6onkvvm58f7vgkser5d7z8sfshlu7s4oz2gztlvj-c036gwrakjejql06klrfc585r \\ 192.168.99.100:2377 To add a manager to this swarm, run &apos;docker swarm join-token manager&apos; and follow the instructions. 上面用 –listen-addr来指定监听的ip和端口。 接下来把worker1和worker2加入集群： #docker-machine ssh worker1 #docker swarm join --token SWMTKN-1-3z5rzoey0u6onkvvm58f7vgkser5d7z8sfshlu7s4oz2gztlvj-c036gwrakjejql06klrfc585r 192.168.99.100:2377 #docker-machine ssh worker2 #docker swarm join --token SWMTKN-1-3z5rzoey0u6onkvvm58f7vgkser5d7z8sfshlu7s4oz2gztlvj-c036gwrakjejql06klrfc585r 192.168.99.100:2377 上面可以加入参数–listen-addr作为监听准备，因为有时候可能遇到把一个worker节点提升为manager节点。本例不添加。 初始化成功后，现在，我们拥有了一个主节点两个从节点的swarm集群，进入管理节点查看一下相应信息： #docker-machine ssh manager1 #docker node ls ID HOSTNAME STATUS AVAILABILITY MANAGER STATUS tdbdcsorrtqymgmn71t5pfwxm * manager1 Ready Active Leader b5twxb6zeacvndsklkxenlhk2 worker1 Ready Active xdvapziebpux1iee52d4tvqa9 worker2 Ready Active 现在，每个节点都归属于swarm，并处于待机状态。manager1是管理节点，worker1和worker2是工作节点。 在管理节点上查看网络状态： #docker-machine ssh manager1 #docker network ls NETWORK ID NAME DRIVER SCOPE de994a4d6a4f bridge bridge local ca45f2e489de docker_gwbridge bridge local 3d22755e453b host host local rgpmn1hh5qe1 ingress overlay swarm 86b55cffdbd2 none null local 可以看到在 swarm 上默认已有一个名为 ingress 的 overlay 网络, 默认在 swarm 里使用，本例子中会创建一个新的 overlay 网络。 #docker network create --driver overlay swarm_test #docker network ls NETWORK ID NAME DRIVER SCOPE de994a4d6a4f bridge bridge local ca45f2e489de docker_gwbridge bridge local 3d22755e453b host host local rgpmn1hh5qe1 ingress overlay swarm 86b55cffdbd2 none null local n9jduvforkcm swarm_test overlay swarm 可以看到我们创建的网络swarm_test。 在跨主机网络上部署应用：首先，分别在各个节点上下载一个要部署应用的镜像： #docker-machine ssh manager1 #docker pull nginx #docker-machine ssh worker1 #docker pull nginx #docker-machine ssh worker2 #docker pull nginx 上面分别在3个节点上下载了nginx的镜像，下面在swarm中部署nginx应用： #docker service create --replicas 2 -p 7080:80 --name hello --networ=swarm_test nginx 查看服务： #docker service ls ID NAME MODE REPLICAS IMAGE PORTS sl4zi20wk6um hello replicated 2/2 nginx:latest *:7080-&gt;80/tcp 查看hello的详细情况： #docker service ps hello ID NAME IMAGE NODE DESIRED STATE CURRENT STATE ERROR PORTS 0b3pykmkl7i9 hello.2 nginx:latest manager1 Running Running 2 hours ago s7ud2yba1p0r hello.3 nginx:latest worker1 Running Running 2 hours ago 可以看出，两个容器分别运行在管理节点和worker1节点。","tags":[{"name":"docker swarm","slug":"docker-swarm","permalink":"http://www.an-time.top/tags/docker-swarm/"},{"name":"虚拟化","slug":"虚拟化","permalink":"http://www.an-time.top/tags/虚拟化/"},{"name":"集群","slug":"集群","permalink":"http://www.an-time.top/tags/集群/"}]}]